[build]
  command = "npm install && npx vite build --config vite.config.prod.ts"
  publish = "dist"

[build.environment]
  NODE_VERSION = "18"
  CI = "true"

# SPA fallback - 只对不存在的文件和不是静态资源的请求生效
[[redirects]]
  from = "/_next/*"
  to = "/_next/:splat"
  status = 200

[[redirects]]
  from = "/*.png"
  to = "/:splat.png"
  status = 200
  force = false

[[redirects]]
  from = "/*.jpg"
  to = "/:splat.jpg"
  status = 200
  force = false

[[redirects]]
  from = "/*.svg"
  to = "/:splat.svg"
  status = 200
  force = false

[[redirects]]
  from = "/*.ico"
  to = "/:splat.ico"
  status = 200
  force = false

[[redirects]]
  from = "/*.js"
  to = "/:splat.js"
  status = 200
  force = false

[[redirects]]
  from = "/*.css"
  to = "/:splat.css"
  status = 200
  force = false

# SPA fallback for all other routes
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200